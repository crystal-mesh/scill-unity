# SCILL - the C# library for the SCILL API
![CI](https://github.com/scillgame/scill-csharp/workflows/CI/badge.svg)

SCILL gives you the tools to activate, retain and grow your user base in your app or game by bringing you features well known in the gaming industry: Gamification. We take care of the services and technology involved so you can focus on your game and content.

Some parts of this C# SDK are automatically generated by the [Swagger Codegen](https://github.com/swagger-api/swagger-codegen) project. You can find the OpenAPI specification in this repository: [SCILL OpenAPI Specs](https://github.com/scillgame/openapi).

<a name="frameworks-supported"></a>
## Frameworks supported
- .NET 4.0 or later

<a name="dependencies"></a>
## Dependencies
- [Proyecto26.RestClient](https://www.nuget.org/packages/Proyecto26.RestClient) - 2.6.1 or later
- [RSG.Promise](https://www.nuget.org/packages/RSG.Promise) - 3.0.1 or later
- [Newtonsoft.Json](https://www.nuget.org/packages/Newtonsoft.Json/12.0.2) - 12.0.2


<a name="about-scill"></a>
## About SCILL

SCILL is a fully customizable toolkit that enables you to integrate tailored challenges, full-fledged Battle Passes and leaderboards
to your game, app and website. SCILL connects seamlessly to your user account and payment systems, adding new retention 
and monetization layers within minutes.

Learn more about SCILL here: [https://www.scillgame.com](https://www.scillgame.com).

Developer documentation can be found here: [https://developers.scillgame.com](https://developers.scillgame.com/sdks/csharp.html) 

<a name="getting-started"></a>
## Getting Started

The API has two main entries: `SCILLBackend` and `SCILLClient`. The `SCILLBackend` class requires an API key to initialize and
should only be used in safe environments like a backend. `SCILLBackend` is also used to generate an access token that is required
when initializing the `SCILLClient` class. `SCILLClient` offers client side functionality like sending events and querying users
challenges and battle passes.

More info about that can be found in our extensive developer documentation: [https://developers.scillgame.com](https://developers.scillgame.com).

Both classes `SCILLBackend` and `SCILLClient` wrap OpenAPI auto generated APIs like `ChallengesApi`. You may use them directly, have
a look in the source of `SCILLBackend` and `SCILLClient` on how to set the API key or Access Token required for the backend REST APIs. 

Check out this code from our Unity example to understand how to use this API:

```csharp
using System.Collections.Generic;

using SCILL;
using SCILL.Api;
using SCILL.Model;
using UnityEngine;

public class SCILLManager : MonoBehaviour
{
    // Properties to be set in the Unity inspector
    public string APIKey;
    public string AppId;
    public SCILL.Environment environment;

    // Getter for the access token
    public string AccessToken => _accessToken;
    
    // In this case, we use a unique devide identifier. Multi device support requires a user account system like
    // Steam, Playfab, etc.
    public string UserId => SystemInfo.deviceUniqueIdentifier;
    
    // Default session id. This is just an example value.
    public string SessionId => "1234";

    // Getter for the singleton instance of this class
    public static SCILLManager Instance; // **<- reference link to SCILL
    
    // Simple wrappers to get SCILL product APIs
    public EventsApi EventsApi => _scillClient.EventsApi;
    public ChallengesApi ChallengesApi => _scillClient.ChallengesApi;
    public BattlePassesApi BattlePassesApi => _scillClient.BattlePassesApi;
    public SCILLClient SCILLClient => _scillClient;

    // Local instances of SCILLClient. Please note, that SCILLBackend should not be used in game clients in production!
    private SCILLBackend _scillBackend;
    private SCILLClient _scillClient;
    private string _accessToken;
    
    private void Awake()
    {
        // Create an instance of this class and make sure it stays (also survives scene changes)
        if (Instance == null) {
            Instance = this;
            
            // This part should be done in the backend if possible to not expose the API key
            _scillBackend = new SCILLBackend(this.APIKey, environment);
            _scillBackend.GetAccessToken(
				accessToken =>
                    {
                        AccessToken = accessToken;

                        SCILLClient = new SCILLClient(AccessToken, AppId, language.ToString(), environment);  
                        OnSCILLManagerReady?.Invoke();
                    },
				null,
				UserId);
            
            DontDestroyOnLoad(gameObject);
        }
        else {
            Destroy(gameObject);
        }
    }

	// Basic convenience function to send an event. Users global UserId and sessionId
	private void SendEventAsync(string eventName, EventPayload payload)
	{
		EventsApi.SendEventAsync(
			response =>
			{
				SCILLNotificationManager.Instance?.AddNotification(SCILLNotificationType.Success,
					"Event sent: " + eventName);
			},
			e =>
			{
				if (e is ApiException apiException)
				{
					HandleEventApiException(eventName, payload, apiException);
				}
				else
				{
					Debug.LogError(e);
					throw e;
				}
			},
			payload);
	}

	private static void HandleEventApiException(string eventName, EventPayload payload, ApiException e)
	{
		Debug.LogError("EVENT FAILED: " + payload.ToJson());
		Debug.LogError(e);
		SCILLNotificationManager.Instance?.AddNotification(SCILLNotificationType.Error,
			"Event failed: " + eventName);
	}

    // Basic wrapper for getting personal challenges
    public void GetPersonalChallengesAsync(Action<List<ChallengeCategory>> resolve, Action<Exception> reject)
	{
		ChallengesApi.GetPersonalChallengesAsync(AppId).Then(resolve).Catch(reject);
	}
}
```
<a name="installation"></a>
## Build from source
Run the following command to generate the DLL
- [Mac/Linux] `/bin/sh build.sh`
- [Windows] `build.bat`

Then include the DLL (under the `bin` folder) in the C# project, and use the namespaces:
```csharp
using SCILL;
using SCILL.Api;
using SCILL.Model;
```